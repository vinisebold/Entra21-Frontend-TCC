<div class="fixed inset-0 z-50 flex items-end justify-end p-3">
  <section
    role="dialog"
    aria-modal="true"
    aria-labelledby="modal-title"
    class="w-full max-w-md rounded-2xl bg-[var(--color-surface-container)] shadow-[0_12px_30px_rgba(0,0,0,0.15)] ring-1 ring-black/5 overflow-hidden"
  >
    <!-- Cabeçalho -->
    <header class="flex items-center justify-between px-5 py-4">
      <h2 id="modal-title" class="title-medium text-[var(--color-on-surface)]">
        Registrar Venda
      </h2>

      <button
        type="button"
        aria-label="Fechar"
        (click)="onFecharClick()"
        class="inline-flex h-8 w-8 items-center justify-center rounded-full text-[var(--color-on-surface-variant)] hover:bg-[var(--color-surface-container2)] hover:text-[var(--color-on-surface)] focus:outline-none focus:ring-2 focus:ring-[var(--color-outline)]/30"
      >
        <svg
          class="icone"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2.2"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            d="M6 18L18 6M6 6l12 12"
          />
        </svg>
      </button>
    </header>

    <!-- Conteúdo -->
    <div class="px-5 pb-5">
      <form class="space-y-5" [formGroup]="vendaForm" (ngSubmit)="onSubmit()">
        <fieldset
          [disabled]="isLoading()"
          class="space-y-5 transition-opacity"
          [class.opacity-50]="isLoading()"
        >
          <!-- Cliente -->
          <div class="space-y-2">
            <label class="label-large text-[var(--color-on-surface-variant)]"
              >Cliente</label
            >
            <div
              class="relative flex items-center overflow-hidden rounded-full border border-[var(--color-surface-container2)] bg-[var(--color-surface)]"
            >
              <select
                formControlName="clienteId"
                class="h-11 w-full appearance-none bg-transparent pl-4 pr-10 text-sm text-[var(--color-on-surface)] outline-none"
              >
                <option value="" disabled>Selecionar cliente...</option>
                @for (c of listaClientes(); track c.id) {
                <option [value]="c.id">{{ c.nome }}</option>
                }
              </select>
              <svg
                aria-hidden="true"
                class="pointer-events-none absolute right-3 h-5 w-5 text-[var(--color-on-surface-variant)]"
                viewBox="0 0 20 20"
                fill="currentColor"
              >
                <path
                  fill-rule="evenodd"
                  d="M5.23 7.21a.75.75 0 011.06.02L10 10.94l3.71-3.71a.75.75 0 111.06 1.06l-4.24 4.24a.75.75 0 01-1.06 0L5.21 8.29a.75.75 0 01.02-1.08z"
                  clip-rule="evenodd"
                />
              </svg>
            </div>
          </div>

          <!-- Situação -->
          <div class="space-y-2">
            <label
              for="situacao"
              class="block text-sm font-medium text-gray-700"
              >Situação</label
            >
            <select
              id="situacao"
              formControlName="situacao"
              class="mt-1 block w-full border-gray-300 rounded-md shadow-sm"
            >
              <option [value]="1">Pendente</option>
              <option [value]="2">Pago</option>
            </select>
          </div>

          <!-- Forma de Pagamento -->
          <div class="space-y-2">
            <label
              for="formaPagamento"
              class="block text-sm font-medium text-gray-700"
              >Forma de Pagamento</label
            >
            <select
              id="formaPagamento"
              formControlName="formaPagamento"
              class="mt-1 block w-full border-gray-300 rounded-md shadow-sm"
            >
              <option [value]="2">Dinheiro</option>
              <option [value]="1">PIX</option>
              <option [value]="3">Cartão</option>
            </select>
          </div>

          <!-- Preço e Parcelas -->
          <div class="grid grid-cols-2 gap-4">
            <!-- Preço de Venda -->
            <div class="space-y-2">
              <label class="label-large text-[var(--color-on-surface-variant)]"
                >Preço de Venda</label
              >
              <div
                class="flex items-center overflow-hidden rounded-xl ring-1 ring-[var(--color-surface-container2)] bg-[var(--color-surface)]"
              >
                <span
                  class="ml-2 mr-2 flex h-7 items-center rounded-md bg-[var(--color-secundary)] px-2 text-xs font-semibold text-[var(--color-outline)]"
                  >R$</span
                >
                <input
                  formControlName="precoVenda"
                  type="text"
                  inputmode="decimal"
                  placeholder="0,00"
                  class="h-10 min-w-0 flex-1 px-3 text-sm bg-transparent placeholder:text-neutral-400 outline-none"
                  appDinheiroMask
                />
              </div>
            </div>

            <!-- Parcelas -->
            <div class="space-y-2">
              <label class="label-large text-[var(--color-on-surface-variant)]"
                >Parcelas</label
              >
              <div
                class="relative flex items-center overflow-hidden rounded-xl ring-1 ring-[var(--color-surface-container2)] bg-[var(--color-surface)]"
                [class.opacity-60]="!isCredito()"
                [class.pointer-events-none]="!isCredito()"
              >
                <input
                  formControlName="parcelas"
                  type="number"
                  min="0"
                  max="12"
                  step="1"
                  placeholder="0"
                  class="h-10 w-full min-w-0 px-3 pr-10 text-sm bg-transparent outline-none"
                />
              </div>
            </div>
          </div>
        </fieldset>

        <!-- Rodapé -->
        <div class="flex items-center justify-end pt-2 gap-4">
          <button
            type="button"
            (click)="onFecharClick()"
            [disabled]="isLoading()"
            class="px-4 py-2 text-sm font-medium text-[var(--color-on-surface-variant)] hover:text-[var(--color-on-surface)] transition disabled:opacity-50"
          >
            Cancelar
          </button>

          <button
            type="submit"
            [disabled]="vendaForm.invalid || isLoading()"
            class="inline-flex min-w-[120px] items-center justify-center gap-2 rounded-full bg-[var(--color-primary)] px-5 py-3 text-sm font-semibold text-[var(--color-surface)] shadow-[0_2px_0_rgba(0,0,0,0.06)] hover:bg-[var(--color-primary2)] focus:outline-none focus:ring-2 focus:ring-[var(--color-primary)]/30 active:translate-y-px disabled:opacity-50 disabled:cursor-not-allowed"
          >
            @if (!isLoading()) {
            <svg class="icone" viewBox="0 0 20 20" fill="currentColor">
              <path
                fill-rule="evenodd"
                d="M16.704 4.153a.75.75 0 01.143 1.052l-8 10.5a.75.75 0 01-1.127.075l-4.5-4.5a.75.75 0 011.06-1.06l3.894 3.893 7.48-9.817a.75.75 0 011.052-.143z"
                clip-rule="evenodd"
              />
            </svg>
            <span>Registrar</span>
            } @else {
            <svg class="h-5 w-5 animate-spin" fill="none" viewBox="0 0 24 24">
              <circle
                class="opacity-25"
                cx="12"
                cy="12"
                r="10"
                stroke="currentColor"
                stroke-width="4"
              ></circle>
              <path
                class="opacity-75"
                fill="currentColor"
                d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
              ></path>
            </svg>
            <span>Registrando...</span>
            }
          </button>
        </div>
      </form>
    </div>
  </section>
</div>
