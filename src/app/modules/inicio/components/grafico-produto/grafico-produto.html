<section class="flex flex-col gap-3">
  <header class="grid grid-cols-3 items-center">
    <div class="flex items-center gap-2 justify-self-start">
      <svg
        class="h-5 w-5 text-on-surface-variant"
        fill="currentColor"
        aria-hidden="true"
      >
        <use href="/sprite.svg#icon-inventario"></use>
      </svg>
      <h3 class="body-large text-on-surface-variant">Estoque por peca</h3>
    </div>
    <div
      class="inline-flex items-center gap-2 text-gray-500 justify-self-center"
    >
      <button
        class="appearance-none border-0 bg-transparent cursor-pointer text-gray-500 text-xs p-1 rounded disabled:opacity-40 disabled:cursor-default"
        (click)="prev()"
        [disabled]="page() === 0"
        aria-label="Anterior"
      >
        <svg
          class="w-3.5 h-3.5 inline-block fill-current rotate-90"
          aria-hidden="true"
          focusable="false"
        >
          <use href="/sprite.svg#icon-chevron-down"></use>
        </svg>
      </button>
      <span class="label-large text-on-surface-variant text-xs text-gray-700">{{
        paginaTexto()
      }}</span>
      <button
        class="appearance-none border-0 bg-transparent cursor-pointer text-gray-500 text-xs p-1 rounded disabled:opacity-40 disabled:cursor-default"
        (click)="next()"
        [disabled]="page() >= totalPages() - 1"
        aria-label="Próximo"
      >
        <svg
          class="w-3.5 h-3.5 inline-block fill-current -rotate-90"
          aria-hidden="true"
          focusable="false"
        >
          <use href="/sprite.svg#icon-chevron-down"></use>
        </svg>
      </button>
    </div>
  </header>

  <div class="grid grid-cols-[max-content_1fr] gap-1.5 items-start">
    @if (carregando()) {
    <div class="col-span-2">Carregando…</div>
    } @else if (erro()) {
    <div class="col-span-2">{{ erro() }}</div>
    } @else {
    <div class="block justify-self-start w-max">
      <ngx-charts-pie-chart
        class="block aspect-square"
        style="width: clamp(80px, 28vw, 200px)"
        [results]="dadosGrafico()"
        [scheme]="colorScheme"
        [legend]="false"
        [labels]="false"
        [gradient]="false"
        [doughnut]="true"
        [arcWidth]="0.38"
      >
      </ngx-charts-pie-chart>
    </div>
    <div>
      <ul class="list-none m-0 p-0 space-y-2">
        @for (c of itensVisiveis(); track i; let i = $index) {
        <!-- Grid 3x2 para alinhar perfeitamente: dot | nome | quantidade / vazio | custo: | preço -->
        <li
          class="grid grid-cols-[max-content_1fr_auto] grid-rows-2 items-start gap-x-4 gap-y-0.5 py-1"
        >
          <!-- Dot -->
          <span
            class="w-3 h-3 rounded-full row-span-2 self-center"
            [style.background]="
              colorScheme.domain[i % colorScheme.domain.length]
            "
          ></span>

          <!-- Nome da categoria -->
          <strong class="title-medium text-on-surface leading-5">{{
            c.name
          }}</strong>

          <!-- Quantidade -->
          <span class="body-medium text-on-surface-variant leading-5 text-right"
            >{{ c.quantidade }} peças</span
          >

          <!-- Custo label -->
          <span class="body-medium text-on-surface-variant leading-5"
            >custo:</span
          >

          <!-- Valor -->
          <span
            class="label-large text-on-surface-variant leading-5 tabular-nums text-right"
            >{{ c.somaPreco | currency : "BRL" : "symbol-narrow" }}</span
          >
        </li>
        @if (i < itensVisiveis().length - 1) {
        <li class="h-px bg-gray-200 my-2" aria-hidden="true"></li>
        } }
      </ul>
    </div>
    }
  </div>
</section>
