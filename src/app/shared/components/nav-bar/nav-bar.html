<nav
  class="h-full overflow-hidden flex flex-col"
  (click)="expandOnBackgroundClick()"
  [class.cursor-e-resize]="collapsed()"
>
  <div class="flex items-center justify-between p-3 mt-2 mb-8">
    <div class="flex items-center space-x-2">
      <button
        [routerLink]="!collapsed() ? '/' : null"
        class="w-12 h-12 rounded-xl flex items-center justify-center shrink-0 hover:bg-surface-container2 transition-colors cursor-pointer"
        (click)="$event.stopPropagation(); collapsed() ? toggle() : null"
        (mouseenter)="logoHovered.set(true)"
        (mouseleave)="logoHovered.set(false)"
        [attr.aria-pressed]="collapsed()"
        [attr.aria-label]="
          collapsed() ? 'Expandir sidebar' : 'Ir para a página inicial'
        "
        [title]="collapsed() ? 'Expandir sidebar' : 'Ir para a página inicial'"
        [class.cursor-pointer]="true"
      >
        @if (collapsed() && logoHovered()) {
        <svg
          class="icone w-6 h-6 text-on-surface-variant"
          aria-hidden="true"
          focusable="false"
        >
          <use [attr.href]="'/sprite.svg#icon-sidebar'"></use>
        </svg>
        } @else {
        <img
          ngSrc="assets/logo.png"
          alt="Logo"
          width="24"
          height="24"
          class="w-6 h-6 object-cover rounded-xl"
        />
        }
      </button>

      <span
        class="nav-label text-on-surface title-medium"
        [attr.aria-hidden]="collapsed()"
      >
        {{ userName() }}
      </span>
    </div>

    @if (!collapsed()) {
    <button
      type="button"
      class="h-12 w-12 flex items-center justify-center cursor-e-resize rounded-xl font-medium hover:bg-surface-container2"
      (click)="$event.stopPropagation(); toggle()"
      aria-label="Colapsar sidebar"
      title="Alternar sidebar"
    >
      <svg
        class="icone text-on-surface-variant"
        aria-hidden="true"
        focusable="false"
      >
        <use [attr.href]="'/sprite.svg#icon-sidebar'"></use>
      </svg>
    </button>
    }
  </div>

  <div class="space-y-1" [class.p-2]="!collapsed()" [class.py-2]="collapsed()">
    @for (item of menuItems; track item.route) {
    <a
      class="nav-item flex items-center rounded-full cursor-pointer transition-colors text-on-surface-variant h-14 [&:not(.bg-primary)]:hover:bg-surface-container2"
      (click)="$event.stopPropagation()"
      [routerLink]="item.route"
      routerLinkActive="bg-primary text-white shadow-md"
      [routerLinkActiveOptions]="{
        paths: 'exact',
        queryParams: 'subset',
        matrixParams: 'subset',
        fragment: 'ignored'
      }"
      [class.justify-between]="!collapsed()"
      [class.w-14]="collapsed()"
      [class.mx-auto]="collapsed()"
      [class.justify-center]="collapsed()"
      [attr.aria-label]="collapsed() ? item.label : null"
      [attr.title]="collapsed() ? item.label : null"
    >
      <span class="nav-label title-medium" [attr.aria-hidden]="collapsed()">{{
        item.label
      }}</span>
      <svg class="icone w-6 h-6 shrink-0" aria-hidden="true" focusable="false">
        <use [attr.href]="item.icon"></use>
      </svg>
    </a>
    }
  </div>

  <!-- Botão Retornar (inferior) -->
  <div
    class="mt-auto p-2 flex"
    [class.justify-end]="!collapsed()"
    [class.justify-center]="collapsed()"
  >
    <a
      routerLink="/"
      class="mb-2 nav-item flex items-center rounded-xl cursor-pointer transition-colors text-on-surface-variant [&:not(.bg-primary)]:hover:bg-surface-container2"
      (click)="logout(); $event.stopPropagation()"
      [class.w-14]="collapsed()"
      [class.mx-auto]="collapsed()"
      [class.justify-center]="collapsed()"
      [attr.aria-label]="collapsed() ? 'Retornar para página inicial' : null"
      [attr.title]="collapsed() ? 'Retornar para página inicial' : null"
    >
      <svg class="icone w-6 h-6 shrink-0" aria-hidden="true" focusable="false">
        <use [attr.href]="'/sprite.svg#icon-retornar'"></use>
      </svg>
    </a>
  </div>
</nav>
